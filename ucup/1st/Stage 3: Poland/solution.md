# The 1st Universal Cup. Stage 3: Poland

## A.Aliases
$(0, 0, 6)$은 조건을 만족하는 해이므로, $a+b+c \le 6$인 모든 경우만 보면 된다. 
$a, b, c$를 확정했을 때 답이 존재하는지는 map 등의 자료구조를 사용해 $O(N \log N)$ 정도에 확인할 수 있다.
시간 제한이 42초라 뭘 해도 맞는다.

## B. Bars
$1, N$번 위치는 반드시 선택하는 것이 이득이다.

$l<m<r$인 인덱스 $l, m, r$에 대해 $l, r$이 이미 선택되어 있고, $(l, r)$에는 아무것도 선택되어 있지 않다고 할 때 $m$을 선택하는 것이 이득일 필요충분조건은 $(l, p_l), (r, p_r)$을 잇는 직선 위쪽에 점 $(m, p_m)$이 존재하는 것이다.
따라서 모든 $i$에 대해 $(i, p_i)$를 점을 찍고, 볼록껍질에 들어가는 점들을 전부 선택하면 최적해가 된다.

## C. Ctrl+C Ctrl+V
앞에서부터 보면서 ania가 등장할 때마다 마지막 a를 다른 문자로 바꾸면 된다.

## D. Dazzling Mountain
DFS 순서대로 리프 노드에 번호를 붙이고, 각 정점에 대해 그 정점의 자손인 리프의 구간을 구해준다.
이는 DFS 한 번으로 할 수 있다.
또한 각 정점에 대해 그 정점을 루트로 하는 서브트리 크기를 구하자.

이후 각 크기 $n$에 대해 서브트리의 크기가 $n$인 정점들을 전부 구하고, 그 정점들의 구간 합집합이 전체 구간이 되는지 확인해주면 된다.
이는 구간을 왼쪽 끝 점 기준으로 정렬하여 순서대로 확인하는 것으로 할 수 있다.

이렇게 하면 한 정점은 한 크기 $n$에 해당하는 작업에만 포함되어서 전체 시간복잡도는 $O(N \log N)$이다.

## E. Euclidean Algorithm
주어진 과정을 다음과 같이 생각할 수 있다.
* 초기에 수직선에 a, b에 점이 찍혀 있다.
* 수직선에 두 점을 골라서 외분점을 찍는 것을 반복한다. 최종 상태에는 $\gcd(a, b)$에 점이 찍혀 있어야 한다.

이 작업에서 점을 최대한 많이 찍는 경우를 생각해본다면, $a, b$를 포함하고 공차가 $|a-b|$인 등차수열에 포함되는 점들이 찍혀 있을 것이다.

이제 조건을 만족하는 $1 \le x<y \le N$의 쌍을 구하자.
$y-x=d$, $g=\gcd(x, y)$를 고정한다면 가능한 쌍으로는 $(g, g+d), (g+d, g+2d), \cdots $이 된다. 즉, 답은 floor sum들의 floor sum 형태가 되고, $\sqrt(N)$ 이상인 부분과 이하인 부분을 나누어 계산하는 것으로 빠르게 풀 수 있다.

풀이에 따라 상수 최적화가 필요한 것으로 보인다.

## F. Flower Garden
조건에서 제시된 두 구간의 크기가 모두 $1$이라면 조건을 다음과 같이 해석할 수 있다.
* $a_i$번 꽃병에 바이올렛이 심겨 있다면 $c_i$도 그렇다.
* $c_i$번 꽃병에 장미가 심겨 있다면 $a_i$도 그렇다.

$3N$개의 꽃병을 정점 집합으로 하고, 모든 조건에 대해 $a_i$에서 $c_i$로 향하는 방향 간선을 포함하는 digraph $G$를 구성하자.
결국 목표는 이렇게 구성된 방향 그래프에서 정점 집합 $S$를 골라서 다음 조건을 만족하도록 하는 것이다.
* $N \le |S| \le 2N$
* $a \in S, \vec{ab} \in E(G)$라면 $b \in S$이다.

즉, $S$는 바이올렛을 심을 꽃병 집합이다.

우선 SCC를 만들고, 역방향 그래프에서 위상정렬을 하자.
다음과 같은 경우가 있다:
* 만약 SCC의 크기가 모두 $N$ 이하라면, 앞서 구한 위상정렬 순서대로 SCC를 하나씩 선택해간다면, 선택한 정점의 개수가 $N$ 이상 $2N$ 이하가 되는 순간이 반드시 온다.
* 크기 $N$ 초과인 SCC는 최대 $2$개 존재할 수 있다. 만약 두 개 존재한다면, 위상정렬 순서대로 SCC를 하나씩 선택해나갈 때 하나의 큰 SCC가 선택되고 나머지 하나가 선택되지 않은 순간에서 선택한 정점의 개수는 $N$ 이상 $2N$ 이하이다.
* 크기 $N$ 초과인 SCC가 정확히 하나 있는 경우, 그 SCC를 포함하는 경우와 포함하지 않는 경우로 나눌 수 있다. 포함하지 않는 경우는 선택하는 정점의 개수가 $2N$개 미만임이 보장되므로, 큰 SCC를 포함하지 않으며 최대한 많은 정점을 선택하는 경우만 보면 된다. 큰 SCC를 포함하는 경우는 정점의 개수가 $N$개 이상임이 보장되므로, 최소한의 정점을 추가하는 경우를 보면 된다.

각 과정은 모두 최대 O(V(G)+E(G))에 확인 가능하다.

이제 주어진 조건들의 구간 크기가 $1$ 초과인 경우를 고려하자.
이는 단순히 모든 $x \in [a_i, b_i], y \in [c_i, d_i]$에 대해 $\bar{xy}$라는 간선을 추가하는 것으로 해석할 수 있고, 세그먼트 트리 형태로 더미 노드를 만들어 간선 개수를 줄이는 잘 알려진 테크닉을 사용하여 $G$를 구성할 수 있다.
